<!DOCTYPE html>

<head>
    <title>Messi - Tu calculadora para La Argentina</title>
    <meta charset="UTF-8">
    <link rel="icon" type="image/gif" href="favicon.gif">
    <link rel="stylesheet" href="https://unpkg.com/mustard-ui@latest/dist/css/mustard-ui.min.css">
    <style>
        .button-primary {
            background-color: #74ACDF;
            border-color: #74ACDF
        }
        
        input:focus,
        select:focus,
        fieldset:focus {
            border-color: #74ACDF
        }
        
        select:focus {
            background-image: linear-gradient(45deg, transparent 50%, #74ACDF 50%), linear-gradient(135deg, #74ACDF 50%, transparent 50%), linear-gradient(to right, #74ACDF, #74ACDF)
        }
        
        a {
            color: #74ACDF;
        }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type=number] {
            -moz-appearance: textfield;
        }
        
        body:after {
            content: "beta";
            position: fixed;
            width: 80px;
            height: 25px;
            background: #74ACDF;
            top: 7px;
            left: -20px;
            text-align: center;
            font-size: 13px;
            font-family: sans-serif;
            text-transform: uppercase;
            font-weight: bold;
            color: #fff;
            line-height: 27px;
            transform: rotate(-45deg);
        }
        
        @media (max-width: 1024px) {
            select {
                font-size: 40px;
                line-height: 40px;
                background-color: #fff;
                background-image: none;
                background-position: none;
                background-size: none;
                padding-right: 30px;
                height: 70px;
            }
            select:focus {
                background-image: none;
            }
            input[type="text"],
            input[type="number"] {
                font-size: 40px;
                line-height: 40px;
                height: 70px;
            }
            table {
                font-size: 40px;
                line-height: 40px;
                height: 70px;
            }
        }
    </style>
    <script>
        (async() => {

            const calculator = {
                ar: "amountAr",
                uy: "amountUy",
                usd: "amountUsd",
                price: "calculatorPrices",
            };

            const pricesList = "pricesList";

            const main = async() => {
                await loadPrices();
                setEvents();
            };

            const getValue = (id) => {
                return document.getElementById(id).value;
            };

            const getFloatValue = (id) => {
                return parseFloat(getValue(id));
            };

            const setValue = (id, value) => {
                document.getElementById(id).value = value;
            };

            const setContent = (id, content) => {
                document.getElementById(id).innerHTML = content;
            };

            const eventAmountKeyUp = (event, field) => {
                const value = parseFloat(event.target.value);
                if (value && value > 0) {
                    const price = getFloatValue(calculator.price);
                    switch (field) {
                        case calculator.ar:
                            setValue(calculator.usd, (value / price).toFixed(2));
                            break;
                        case calculator.usd:
                            setValue(calculator.ar, value * price);
                            break;
                        default:
                    }
                } else {
                    event.target.reportValidity();
                }
            };

            const setEvents = () => {
                document.getElementById(calculator.ar)
                    .addEventListener("keyup", (event) => eventAmountKeyUp(event, calculator.ar));
                document.getElementById(calculator.usd)
                    .addEventListener("keyup", (event) => eventAmountKeyUp(event, calculator.usd));
            };

            const loadPrices = async() => {
                const prexPrice = await getPrexPrice();
                loadCalculatorPrices([{
                    name: "PREX",
                    price: prexPrice
                }]);
                loadPriceList([{
                    name: "üá∫üá∏ U$S PREX",
                    buy: prexPrice,
                    sell: 0
                }]);
            };

            const loadCalculatorPrices = (prices) => {
                setContent(
                    calculator.price,
                    prices.map((price) => `<option value="${price.price}">${price.name}</option>`, prices)
                );
            };

            const loadPriceList = (prices) => {
                setContent(
                    pricesList,
                    prices.map((price) => `<tr><td>${price.name}</td><td><p class="align-right"><strong>${price.buy > 0 ? price.buy : 'N/A'}</strong></p></td><td><p class="align-right"><strong>${price.sell > 0 ? price.sell : 'N/A'}</strong></p></td>`,
                        prices
                    ));
            };

            const getPrexPrice = async() => {
                const defaultPrice = parseFloat(430);
                const url = "https://www.prexcard.com/hacelabien";
                try {
                    const response = await fetch(url);
                    const text = await response.text();
                    return parseFloat(
                        /<p class='cambioPesosArg'>\$AR (.*)<\/p>/g
                        .exec(text)[1]
                        .replace(",", ".")
                    ).toFixed(2);
                } catch (ex) {
                    console.error(ex);
                    return defaultPrice;
                }
            };

            window.addEventListener("load", main);
        })();
    </script>
</head>

<body>
    <section class="section-secondary">
        <div class="row">
            <div class="col col-md-12">
                <div class="card">
                    <h3 class="card-title">Cambio</h3>
                    <div style="margin-top: 16px;" class="form-control-group">
                        <div class="form-control">
                            <input id="amountAr" type="number" step="0.01" placeholder="üá¶üá∑ $AR">
                        </div>
                        <div class="form-control">
                            <select id="calculatorPrices"></select>
                        </div>
                    </div>
                    <div style="margin-top: 8px;" class="form-control-group">
                        <div class="form-control">
                            <input id="amountUy" type="number" step="0.01" placeholder="üá∫üáæ $UY" disabled>
                        </div>
                        <div class="form-control">
                            <input id="amountUsd" type="number" step="0.01" placeholder="üá∫üá∏ U$S">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-md-12">
                <div class="card">
                    <h3 class="card-title">Cotizaciones</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Moneda</th>
                                <th class="align-right">Compra</th>
                                <th class="align-right">Venta</th>
                            </tr>
                        </thead>
                        <tbody id="pricesList"></tbody>
                    </table>
                </div>
            </div>
            <div class="col col-md-12">
                <div class="card">
                    <h3 class="card-title">Buscar</h3>
                    <!-- <input type="text" placeholder="Descripci√≥n del producto">
                    <ul class="card-actions">
                        <li><button class="button-primary">Buscar</button></li>
                    </ul> -->
                    <strong>En construcci√≥n...</strong>
                    <div class="progress-bar">
                        <span class="progress-bar-green" style="width: 20%;"></span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section>
        <div class="row">
            <div>
                <img src="logo.png" />
            </div>
            <div class="col col-md-9">
                <p>Est√°s en argentina, odiado por todos porque sos uruguayo y ten√©s plata.<br>Seguramente ten√©s la calculadora en una mano, Google o MercadoLibre en otra; parec√©s Russell Crowe en <a href="https://www.imdb.com/title/tt0268978" target="_blank">Una Mente Brillante</a>,
                    luchando por determinar si te sirve comprar. Ya no m√°s, ahora ten√©s a Messi para ayudarte y resolver todo en el mismo lugar.</p>
                <p>Si por casualidad code√°s o quer√©s sugerir algo, pasate por <a href="https://github.com/bcattaneo/messi" target="_blank">bcattaneo/messi</a>.</p>
            </div>
        </div>
    </section>
</body>

</html>